# 10up Projects (BETA)

**This subcommand is currently in BETA**

10up Toolkit provides a number of utlities for creating, managing, and deploying 10up specific projects.

## Anatomy of a Project

A standard 10up GitLab project initialized with 10up Toolkit looks like the following:

```
.tenup.yml
.gitlab-ci.yml
/scripts
  build.sh
```

`.tenup.yml` contains a number of variables the define the structure of the project e.g. the WordPress version and how to deploy the application.

`.gitlab-ci.yml` is a standard GitLab CI file that is generated by 10up Toolkit. It usually doesn't need to be edited but occassionally may need customization for more advanced CI workflows.

`build.sh` contains the commands for building a project. Engineers will need to edit this file to ensure it contains the proper build commands.

### .tenup.yml

`.tenup.yml` is automatically generated by the init command but you may want to create one yourself. Also, even after init, you will need to make sure it includes the proper values. Here is the anatomy of the file:

```yaml
project_name: "10up Project"
environments:
	production:
		branch: "trunk"
		wordpress_version: "6.4"
		deploy_to: "gitlab@1.1.1.1:/var/www/my-project"
		deploy_to_subdir: "wp-content/"
		deploy_from: "./"
		deploy_type: "rsync"
		url: "https://environmenturl.com"
	staging:
		branch: "staging"
		wordpress_version: "6.4"
		deploy_to: "gitlab@1.1.1.1:/var/www/my-project"
		deploy_to_subdir: "wp-content/"
		deploy_from: "./"
		deploy_type: "rsync"
		url: "https://environmenturl.com"
```

`deploy_from` and `deploy_to_subdir` let you choose what directory of your application deploys to which part of WordPress. `deploy_to` is the full remote path to WordPress. `deploy_from` is relative to the root of your project. `deploy_to_subdir` is relative to `deploy_to`. By default, it's set up such that the root of your application deploys to `wp-content`. Another setup is where your application is one level above WordPress e.g.

```
.tenup.yml
/wp
  /wp-content
```

In this scenario, `deploy_from` would be set to `wp` and `deploy_to_subdir` would be `./`.

`deploy_type` currently supports `rsync`, `wpe` (WP Engine), and `pantheon`. It defaults to `rsync`. If WPE or Pantheon is choosen, `deploy_to` should contain a Git URL. More deploy types will be added in the future.

The following are additional optional variables that allow you to use custom scripts different than the ones provided by 10up Toolkit. You shouldn't need to use these unless you are doing something super custom. All these paths are relative from the root of your project.

```yaml
deploy_script_path: "" # Custom deploy script
build_script_path: "" # For using a build script in a different location
create_payload_script_path: "" # Custom create payload script
```

## Commands

The project subcommand provides a variety of utlities for creating, building, and deploying 10up-specific projects.

List of commands:

```bash
10up-toolkit project init [<path>] [--template=<Git repository>] [--name=<Project Name>] [--confirm]
```

`init` creates a project. You can optionally provide it a number of parameters or answer the prompts. If no path is provided, it will initialize the project in the current directory. You will be prompted to choose a template e.g. [WP Scaffold](https://github.com/10up/wp-scaffold). Init will automatically search and replace prefixes using the project name you provide.

```bash
10up-toolkit project build
```

`build` simply executes your `scripts/build.sh` file (or other path you specify). `build` will be executed before deploying files.

```bash
10up-toolkit project create-payload <branch>
```

This command creates a payload directory of the built project (including WordPress) for deployment. Engineers likely won't need to run this command themselves as GitLab does it automatically. You must provide a branch that corresponds to an environment in `.tenup.yml`.

```bash
10up-toolkit project generate-ci [--confirm] [--path=<path>]
```

This command generates necessary CI files. For GitLab, this would be `.gitlab-ci.yml`. Right now this only supports GitLab but we will add support for GitHub in the future.

**Note that generating CI files is currently in alpha and may require manual editing to fix issues.**
